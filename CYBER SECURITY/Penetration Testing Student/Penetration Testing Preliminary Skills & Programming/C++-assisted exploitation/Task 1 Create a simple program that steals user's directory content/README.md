# 任务 1：创建一个窃取用户目录内容的简单程序

使用 C++ 编写一个程序，检查目标目录中存储了哪些文件和目录，并将它们的名称发送回渗透测试人员。

提示：

* 您可能想要使用`dirent` C++ 库。

* 对于此工具的网络功能，使用`Winsock`库并通过 TCP 发送数据会更简单。

* 对于接收数据，您可以使用 `netcat` 或 `ncat` 之类的工具 - 不要自己编写。

* 您可以将通过 RDP 连接的机器用作受害者机器。您不需要将创建的窃取程序发送到其他任何地方。

关于`Winsock`库的知识请参考：[Winsock客户端和服务器代码](https://r3kind1e.github.io/2021/10/12/Winsock%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%92%8C%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BB%A3%E7%A0%81/)，关于列出文件系统的文件的多种方式请参考：[Linux下的dirent.h与C++17的std::filesystem命名空间](https://r3kind1e.github.io/2021/10/14/dirent.h/)。

要在Windows下使用`dirent.h`，你需要：[tronkko/dirent](https://github.com/tronkko/dirent)。



**文件名：**`ls.cpp`

**用法：**`ls.exe server-name ["dirname1"] ["dirname2"] ... ["dirnamen"]`

**用法详解：**

* 当不传入任何命令参数时，程序会提示用户正确的用法。

  输入：`ls.exe`

  输出：`usage: ls.exe server-name ["dirname1"]["dirname2"] ...["dirname n"]`

* 传入一个命令参数，为服务器的域名或者是IP地址。程序会将当前工作目录中的目录和文件的名字发送到服务器。

  输入：`ls.exe 192.168.248.129`，或者是`ls.exe www.baidu.com`

* 传入两个命令参数，第一个为服务器的域名或者是IP地址，第二个为指定的目录（需要用双引号括起来）。

  输入：`ls.exe 192.168.248.129 "C:\\Develop"`

* 传入多个命令参数，第一个为服务器的域名或者是IP地址，其它的为指定的目录（需要用双引号括起来），参数之间使用空格分隔。

  输入：`ls.exe 192.168.248.129 "C:\\Develop" "C:\Ruby30-x64"`

  

**环境要求：**以下代码在Visual Studio 2019 16.10 ，C++ 语言标准：预览-最新 C++ 工作草案中的功能（/std:c++latest）测试通过。因为使用了C++20的`std::format`。

**优点：**可以读取任意多个用户目录；进行错误检查；只需调用一次send，就可以将所有数据一次性发送；传输的数据格式直观；

**缺点：**C++语言标准为最新，向下兼容性差。

